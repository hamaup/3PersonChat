# 有人チャットボットシステム 要件仕様書・設計書

以下は、有人チャットボットシステムの要件仕様書および設計書のまとめです。システムの目的は、AIによる自動応答と人間オペレーターによる対応を組み合わせ、ユーザーからの複雑な問い合わせに柔軟に対応できる仕組みを提供することにあります。

## 1. 目的・背景

本仕様書は、ユーザーとAIチャットボット間の自動応答と、必要に応じた有人オペレーターへのエスカレーション機能を統合したシステム要件を定義します。AI だけでは対応できない案件に対して、人間のオペレーターが介入するハイブリッド運用を想定しています。

## 2. 適用範囲

- Web とモバイルアプリのチャットインターフェースを提供します。
- メールや電話など、有人チャネルへのエスカレーションをサポートします。

## 3. 用語定義

- **チャットボット**: ユーザーとの対話を自動処理するソフトウェア。
- **有人ハンドオフ**: AI から人間オペレーターに会話を引き継ぐ機能。
- **信頼度スコア**: AI 応答の確信度を示す指標。

## 4. 機能要件

1. ユーザーからの問い合わせを受け付けて初期自動応答を行う。
2. 信頼度スコアやキーワード判定により、必要に応じてオペレーターへエスカレーションする。
3. オペレーター用 UI に未対応会話一覧、会話履歴、ユーザーコンテキストを表示する。
4. 会話ログを統合的に保存し検索できるようにする。

## 5. 非機能要件

- **レスポンス性能**: 平均応答時間 200ms 以下を目標とする。
- **可用性**: 年稼働率 99.9% 以上を確保する。
- **セキュリティ**: 通信は TLS1.2 以降で暗号化する。
- **スケーラビリティ**: 同時接続ユーザー数 5,000 件まで水平スケールできる。

## 6. ユースケース

| ID | 概要 | アクター | 前提条件 | 事後条件 |
|----|------|----------|----------|----------|
| UC-01 | 問い合わせ受付 | ユーザー | システム稼働中 | 自動応答を受信 |
| UC-02 | 有人ハンドオフ | システム | 信頼度スコアが閾値未満 | オペレーター画面に移行 |

## 7. システム概要

システムはマイクロサービスアーキテクチャで構成され、以下のコンポーネントを持ちます。

- **Bot サービス**: NLP エンジンを使いユーザー入力を解析し、自動応答を生成します。
- **Handoff サービス**: 信頼度スコアやキーワードに基づきエスカレーション制御を行います。
- **Operator サービス**: 未対応会話のプール、通知機能、チャット UI を提供します。
- **ログ基盤**: 会話履歴を保存し、検索と可視化を行います。

## 8. アーキテクチャ図

- ハードウェア・ソフトウェア・ネットワーク構成を記載します。

## 9. データベース設計

- **Users**: ユーザー情報を保持。
- **Conversations**: 会話セッション情報を保存。
- **Messages**: メッセージ単位のログを格納。

## 10. API 設計

- `POST /api/v1/message`: ユーザーメッセージ受信と自動応答またはエスカレーション。
- `GET /api/v1/conversations/{id}`: 会話履歴取得。
- `POST /api/v1/handoff`: エスカレーション要求送信。

## 11. UI 設計

1. **ユーザー用チャット画面**: メッセージ送受信とステータス表示。
2. **オペレーター用ダッシュボード**: 未対応リスト、会話詳細、通知パネル。

## 12. シーケンス図

ユーザーから Bot サービス、Handoff サービス、Operator サービスへの遷移を図示します。

## 13. セキュリティ要件

- **認証**: OAuth2.0 と JWT による API 保護を実装。
- **データ暗号化**: 通信および保存データを AES-256 で暗号化。

## 14. 運用設計

- **ログ監視**: ELK スタックでアラート設定を行います。
- **バックアップ**: DB を日次バックアップし、S3 へ保存します。

